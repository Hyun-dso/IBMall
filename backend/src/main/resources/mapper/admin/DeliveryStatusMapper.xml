<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  
<mapper namespace="com.itbank.mall.mapper.admin.DeliveryStatusMapper">

  <update id="updateOrderStatus">
  UPDATE deliveries
  SET status = #{status},
      tracking_number = CASE
          WHEN #{status} = 'SHIPPING' THEN COALESCE(#{trackingNumber}, tracking_number)
          ELSE tracking_number
      END
  WHERE order_id = #{orderId}
</update>

</mapper>