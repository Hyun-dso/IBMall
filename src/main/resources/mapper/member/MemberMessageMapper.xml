<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itbank.mall.mapper.MemberMessageMapper">

    <!-- 쪽지 리스트 조회 -->
    <select id="selectMessagesByReceiverId" resultType="com.itbank.mall.dto.member.MemberMessageDto">
    SELECT 
        message_id AS messageId,
        receiver_id AS receiverId,
        sender,
        title,
        content,
        image_url AS imageUrl,
        is_read AS isRead,
        created_at AS createdAt
    FROM message
    WHERE receiver_id = #{receiverId}
AND (scheduled_at IS NULL OR scheduled_at &lt;= NOW())
    ORDER BY created_at DESC
</select>

    <!-- 쪽지 상세 조회 -->
<select id="selectMessageById" resultType="com.itbank.mall.dto.member.MemberMessageDto">
    SELECT 
        message_id AS messageId,
        receiver_id AS receiverId,
        sender,
        title,
        content,
        image_url AS imageUrl,
        is_read AS isRead,
        created_at AS createdAt
    FROM message
    WHERE message_id = #{messageId}
AND (scheduled_at IS NULL OR scheduled_at &lt;= NOW())
</select>



    <!-- 읽음 처리 -->
    <update id="updateReadStatus">
        UPDATE message
        SET is_read = 1
        WHERE message_id = #{messageId}
    </update>

    <!-- 쪽지 등록 -->
    <insert id="insertMessage">
        INSERT INTO message (receiver_id, sender, title, content, image_url)
        VALUES (#{receiverId}, #{sender}, #{title}, #{content}, #{imageUrl})
    </insert>

</mapper>
